@{
    Layout = null;
}
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Service Request</title>

    <link href="~/lib/bootstrap/bootstrap.min.css" rel="stylesheet" />
    <link href="~/css/Admin.css" rel="stylesheet" />

    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.0/css/all.css" integrity="sha384-lZN37f5QGtY3VHgisS14W3ExzMWZxybE1SJSEsQp9S+oqd12jhcu+A56Ebc1zFSJ" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.2/css/bootstrap.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.11.3/css/dataTables.bootstrap4.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/responsive/2.2.9/css/responsive.bootstrap4.min.css">
</head>
<style>
    .modal-title {
        color: #646464 !important;
        font-size: larger;
        font-weight: bolder;
    }

    .modal-body {
        color: #646464 !important;
        font-size: 16px;
        font-family: 'roboto';
    }

    #servicedate {
        color: #a0a0a0;
    }

    #servicetime {
        /* padding: 10px 10px 10px 10px; */
        border: 1px solid #e1e1e1;
        color: #a0a0a0;
    }

    #update {
        background-color: #1fb6ff;
        border: none !important;
        color: white !important;
        width: 100%;
        height: 46px;
    }
    body
    {
        overflow-x :hidden !important;
    }
</style>
<body>
    <header>
        <nav class="navbar navbar-expand-sm admin-navbar ">
            <div class="admin-header">helperland</div>
            <!-- <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavDropdown" aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button>
             <div class="collapse navbar-collapse " id="navbarNavDropdown">-->
            <ul class="nav navbar-nav ml-auto">
                <li class="nav-item admin-user">

                    <img src="../images/admin-user.png" alt=""> <span class="admin-name">James Smith</span>

                </li>
                <li class="nav-item dropdown logout">

                    <a class="nav-link" href="#" id="navbarDropdown" role="button" aria-expanded="false">
                        <img src="../images/logout.png" alt="">
                    </a>

                </li>
            </ul>
        </nav>
    </header>
    <!----------side toggle bar------------------>
    <section class="side-toggle-bar">
        <nav class="navbar navbar-expand-xl">
            <button class="navbar-toggler navbar-light" type="button" data-toggle="collapse" data-target="#navbarNavDropdown" aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation" id="collapse-button"> <span class="navbar-toggler-icon"></span> </button>
            <div class="collapse navbar-collapse  " id="navbarNavDropdown">
                <ul class="nav flex-column " id="navbarNavDropdown">
                    <li class="nav-item ">
                        <a class="nav-link  admin-side-menu-content" href="#">Service Managment</a>
                    </li>
                    <hr class="admin-side-menu-line">
                    <li class="nav-item">
                        <a class="nav-link  admin-side-menu-content" href="#">Role Managment</a>
                    </li>

                    <hr class="admin-side-menu-line">
                    <div id="accordion">
                        <div class="card">
                            <div class="card-header">
                                <a class="card-link" data-toggle="collapse" href="#collapseOne">
                                    Coupon Code Management<img src="images/admin-arrow.png" onclick="rotateimg1()" id="img1" alt="" class="admin-arrow">
                                </a>
                            </div>
                            <div id="collapseOne" class="collapse" data-parent="#accordion">
                                <div class="card-body">
                                    <p><a href="#" class="text-secondary">Coupon Codes</a></p>
                                    <p><a href="#" class="text-secondary">Usage History</a></p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <hr class="admin-side-menu-line">
                    <li class="nav-item ">
                        <a class="nav-link  admin-side-menu-content " href="#">Escalation Management</a>
                    </li>
                    <hr class="admin-side-menu-line">
                    <li class="nav-item">
                        <a class="nav-link  admin-side-menu-content " href="#">Service Requests</a>
                    </li>
                    <hr class="admin-side-menu-line">
                    <li class="nav-item">
                        <a class="nav-link  admin-side-menu-content " href="#">Service Providers</a>
                    </li>
                    <hr class="admin-side-menu-line">
                    <li class="nav-item ">
                        <a class="nav-link  admin-side-menu-content " href="#user-managment">User Management</a>
                    </li>
                    <hr class="admin-side-menu-line">
                    <div id="accordion">
                        <div class="card">
                            <div class="card-header">
                                <a class="card-link" data-toggle="collapse" href="#collapseTwo">
                                    Finance Module<img src="images/admin-arrow.png" onclick="rotateimg1()" id="img1" alt="" class="admin-arrow">
                                </a>
                            </div>
                            <div id="collapseTwo" class="collapse" data-parent="#accordion">
                                <div class="card-body">
                                    <p><a href="#" class="text-secondary">All Transaction</a></p>
                                    <p><a href="#" class="text-secondary">Genrate Payment</a></p>
                                    <p><a href="#" class="text-secondary">Customer Invoice</a></p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <hr class="admin-side-menu-line">
                    <li class="nav-item ">
                        <a class="nav-link  admin-side-menu-content " href="#">Zip Code Management </a>
                    </li>
                    <hr class="admin-side-menu-line">
                    <li class="nav-item">
                        <a class="nav-link  admin-side-menu-content " href="#">Rating Management </a>
                    </li>
                    <hr class="admin-side-menu-line">
                    <li class="nav-item">
                        <a class="nav-link  admin-side-menu-content " href="#">Inquiry Management</a>
                    </li>
                    <hr class="admin-side-menu-line">
                    <li class="nav-item ">
                        <a class="nav-link  admin-side-menu-content " href="#">Newsletter Management </a>
                    </li>
                    <hr class="admin-side-menu-line">
                    <div id="accordion">
                        <div class="card">
                            <div class="card-header">
                                <a class="card-link" data-toggle="collapse" href="#collapseThree">
                                    Content Management<img src="images/admin-arrow.png" onclick="rotateimg1()" id="img1" alt="" class="admin-arrow">
                                </a>
                            </div>
                            <div id="collapseThree" class="collapse" data-parent="#accordion">
                                <div class="card-body">
                                    <p><a href="#" class="text-secondary">Blog</a></p>
                                    <p><a href="#" class="text-secondary">FAQs</a></p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <hr class="admin-side-menu-line">
                </ul>


            </div>
        </nav>
    </section>
    <section>
        <div class="container-fluid">
            <div class="row">
                <div class=" col-xl-2 admin-side-menu">

                    <ul class="nav flex-column ">
                        <li class="nav-item ">
                            <a class="nav-link  admin-side-menu-content" href="#">Service Managment</a>
                        </li>
                        <hr class="admin-side-menu-line">
                        <li class="nav-item">
                            <a class="nav-link  admin-side-menu-content" href="#">Role Managment</a>
                        </li>

                        <hr class="admin-side-menu-line">
                        <div id="accordion">
                            <div class="card">
                                <div class="card-header">
                                    <a class="card-link" data-toggle="collapse" href="#collapseOne">
                                        Coupon Code Management<img src="../images/admin-arrow.png" onclick="rotateimg1()" id="img1" alt="" class="admin-arrow">
                                    </a>
                                </div>
                                <div id="collapseOne" class="collapse" data-parent="#accordion">
                                    <div class="card-body">
                                        <p><a href="#" class="text-secondary">Coupon Codes</a></p>
                                        <p><a href="#" class="text-secondary">Usage History</a></p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <hr class="admin-side-menu-line">
                        <li class="nav-item ">
                            <a class="nav-link  admin-side-menu-content " href="#">Escalation Management</a>
                        </li>
                        <hr class="admin-side-menu-line">
                        <li class="nav-item">
                            <a class="nav-link  admin-side-menu-content " href="#">Service Requests</a>
                        </li>
                        <hr class="admin-side-menu-line">
                        <li class="nav-item">
                            <a class="nav-link  admin-side-menu-content " href="#">Service Providers</a>
                        </li>
                        <hr class="admin-side-menu-line">
                        <li class="nav-item ">
                            <a class="nav-link  admin-side-menu-content " href="#user-managment">User Management</a>
                        </li>
                        <hr class="admin-side-menu-line">
                        <div id="accordion">
                            <div class="card">
                                <div class="card-header">
                                    <a class="card-link" data-toggle="collapse" href="#collapseTwo">
                                        Finance Module<img src="../images/admin-arrow.png" onclick="rotateimg1()" id="img1" alt="" class="admin-arrow">
                                    </a>
                                </div>
                                <div id="collapseTwo" class="collapse" data-parent="#accordion">
                                    <div class="card-body">
                                        <p><a href="#" class="text-secondary">All Transaction</a></p>
                                        <p><a href="#" class="text-secondary">Genrate Payment</a></p>
                                        <p><a href="#" class="text-secondary">Customer Invoice</a></p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <hr class="admin-side-menu-line">
                        <li class="nav-item ">
                            <a class="nav-link  admin-side-menu-content " href="#">Zip Code Management </a>
                        </li>
                        <hr class="admin-side-menu-line">
                        <li class="nav-item">
                            <a class="nav-link  admin-side-menu-content " href="#">Rating Management </a>
                        </li>
                        <hr class="admin-side-menu-line">
                        <li class="nav-item">
                            <a class="nav-link  admin-side-menu-content " href="#">Inquiry Management</a>
                        </li>
                        <hr class="admin-side-menu-line">
                        <li class="nav-item ">
                            <a class="nav-link  admin-side-menu-content " href="#">Newsletter Management </a>
                        </li>
                        <hr class="admin-side-menu-line">

                        <div id="accordion">
                            <div class="card">
                                <div class="card-header">
                                    <a class="card-link" data-toggle="collapse" href="#collapseThree">
                                        Content Management<img src="../images/admin-arrow.png" onclick="rotateimg1()" id="img1" alt="" class="admin-arrow">
                                    </a>
                                </div>
                                <div id="collapseThree" class="collapse" data-parent="#accordion">
                                    <div class="card-body">
                                        <p><a href="#" class="text-secondary">Blog</a></p>
                                        <p><a href="#" class="text-secondary">FAQs</a></p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <hr class="admin-side-menu-line">
                    </ul>

                </div>
                <div class=" col-xl-10 admin-main " style="background-color:  #f2f4f5; " id="user-managment">
                    <div class="row " style="margin-top: 29px; max-width: 1100px;">
                        <div class=" col-md-12 User-managment-heading">Service Requests</div>

                    </div>

                    <!-----------------Search User--------------------------->
                    <!----------------table------------------------------->

                    <div class="d-flex flex-column table-container">
                        <h6>Service Requests</h6>
                        <!--horizontal form starts-->
                        <div class="form">
                            <div class="row g-3" style="background-color:white; margin-left:10px; padding-bottom : 20px;">
                                <div class="col-auto">
                                    <input type="text" class="form-control second-col Customer-form" id="serviceId" placeholder="Service ID" />
                                </div>
                                <div class="col-auto">
                                    <input type="text" class="form-control second-col Customer-form" id="postalCode" placeholder="Postal code" />
                                </div>
                                <div class="col-auto">
                                    <input type="text" class="form-control second-col Customer-form" id="email" placeholder="Email" />
                                </div>
                                <div class="col-auto">
                                    <input type="text" class="form-control second-col Customer-form" id="customerName" placeholder="Customer Name" />
                                </div>
                                <div class="col-auto">
                                    <input type="text" class="form-control second-col Customer-form" id="spName" placeholder="Service Provider Name" />
                                </div>
                                <div class="col-auto">
                                    <select class="form-select second-col Customer-form" id="status" style="width:220px; height:38px;">
                                        <option selected value="">Select Status</option>
                                        <option value=5>Pending</option>
                                        <option value=2>Accepted</option>
                                        <option value=1>Completed</option>
                                        <option value=3>Cancelled</option>
                                        <option value=4>New</option>
                                    </select>
                                </div>

                                <div class="col-auto">
                                    <input type="date" class="form-control second-col Customer-form" id="fromDate" placeholder="From Date" />
                                </div>
                                <div class="col-auto">
                                    <input type="date" class="form-control second-col Customer-form" id="toDate" placeholder="To Date" value="To Date" />
                                </div>
                                <div class="col-auto">
                                    <button id="searchBtn" class="first-col user-search-button">Search</button>

                                    <button id="clearBtn" class="first-col user-clear-button">Clear</button>
                                </div>
                            </div>
                        </div>

                        <!--responsive table starts-->
                        <table id="table_id" class="table table-borderless display nowrap" style="overflow-x :hidden;">
                            <thead>
                                <tr>
                                    <th>Service ID</th>
                                    <th>Service Date</th>
                                    <th>Cutomer Details</th>
                                    <th>Service Provider</th>


                                    <th>Status</th>

                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr></tr>
                            </tbody>
                        </table>



                    </div>
                </div>
            </div>
    </section>

    <div class="container edit-modal">
        <div class="modal" id="EditReschedule">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">

                    <!-- Modal Header -->
                    <div class="modal-header">
                        <h4 class="modal-title text-center">Edit Service Request</h4>
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                    </div>

                    <!-- Modal body -->
                    <div class="modal-body px-3">
                        <div id="editingmodal" class="address-form">

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>



    <div class="modal" id="CancelModal">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">

                <!-- Modal Header -->
                <div class="modal-header">
                    <h4 class="modal-title" style="color:#646464;"><b>Cancel Service Request</b></h4>
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                </div>

                <!-- Modal body -->
                <div class="modal-body">
                    <label style="color:#646464;">Why you want to cancel the service request?</label>
                    <div class="row">
                        <div class="col-12">
                            <textarea name="comment" rows="3" style="width: 100%; border-radius: 4px; border-color:#646464;"></textarea>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-12">
                            <button type="button" id="cancle" value="" class="savecomputer-btn" onclick="CancleNow(this.value);" style="width:100%;"><b>Cancel Now</b></button>
                        </div>
                    </div>
                </div>

                <!-- Modal footer -->


            </div>
        </div>
    </div>
    <!--Edit-Reschedule modal-->

    <script src="~/js/jquery.min.js"></script>
    <script src="~/js/popper.min.js"></script>
    <script src="~/js/bootstrap.min.js"></script>


    <script src="~/lib/bootstrap/dist/js/bootstrap.js"></script>
    <script src="~/lib/jquery/dist/jquery.js"></script>
    <script src="~/lib/jquery-validation/dist/jquery.validate.js"></script>
    <script src="~/lib/jquery-validation-unobtrusive/jquery.validate.unobtrusive.js"></script>
    <script src="~/jquery-ajax-unobtrusive/jquery.unobtrusive-ajax.js"></script>

    <script src="https://code.jquery.com/jquery-3.5.1.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.2/js/bootstrap.bundle.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/1.11.3/js/jquery.dataTables.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/1.11.3/js/dataTables.bootstrap4.min.js"></script>
    <script src="https://cdn.datatables.net/responsive/2.2.9/js/dataTables.responsive.min.js"></script>
    <script src="https://cdn.datatables.net/responsive/2.2.9/js/responsive.bootstrap4.min.js"></script>
    <script>
        $(document).ready(function () {
            findParameters();

        });


        function findParameters() {
            var table = $("#table_id").DataTable({
                info: false,
                processing: true,
                responsive: true,
                serverSide: true,
                ajax: {
                    url: "/Admin/FilterData",
                    type: "POST",
                    datatype: "json",
                },
                columnDefs: [
                    {
                        targets: 0,
                        name: "ServiceRequestId",
                        className: "serviceId",
                        render: function (data, type, row, meta) {
                            return row.serviceRequestId;
                        },
                    },
                    {
                        targets: 1,
                        name: "ServiceStartDate",
                        render: function (data, type, row, meta) {
                            return getDateColumnData(row);
                        },
                    },
                    {
                        targets: 2,
                        name: "CustomerName",
                        render: function (data, type, row, meta) {
                            return getCustomerColumnData(row);
                        },
                    },
                    {
                        targets: 3,
                        name: "SPName",

                        render: function (data, type, row, meta) {
                            return getSPColumnData(row);
                        },
                        defaultContent: " ",
                    },
                  
                    {
                        targets: 4,
                        orderable: false,
                        render: function (data, type, row, meta) {
                            return getStatusColumnData(row);
                        },
                    },
                   
                    {
                        targets: 5,
                        orderable: false,
                        render: function (data, type, row, meta) {
                            return getActionColumnData(row);
                        },
                    },
                ],
                stripeClasses: [],
                aLengthMenu: [
                    [5, 10, 15, -1],
                    [5, 10, 25, "All"],
                ],
                dom: '<"float-left"B><"float-right"f>rt<"row"<"col-sm-4"l><"col-sm-4"i><"col-sm-4"p>>',
                pageLength: 10,
                paging: "true",
                pagingType: "simple_numbers",
                language: {
                    paginate: {
                        first: '<img src="./images/first-page.png">',
                        next: '<i class="fas fa-angle-right"></i>',
                        previous: '<i class="fas fa-angle-left"></i>',
                        last: '<img src="./images/first-page.png" style="transform:rotate(180deg);">'
                    },
                },


                responsive: {
                    details: {
                        display: $.fn.dataTable.Responsive.display.modal({
                            header: function (row) {
                                var data = row.data();
                                return 'Details for ' + data[0] + ' ' + data[1];
                            }
                        }),
                        renderer: $.fn.dataTable.Responsive.renderer.tableAll({
                            tableClass: 'table'
                        })
                    }
                }
            });

            $("#table_id_filter").hide();

            oTable = $("#table_id").DataTable();

            //oTable.on("draw", function () {
            //    $(".rateit").rateit();
            //});

            $.fn.dataTable.ext.errMode = "none";
            oTable.on("error.dt", function (e, settings, techNote, message) {
                console.log("An error occurred: ", message);
            });
            $("#searchBtn").click(function () {
                oTable.search([
                    $("#serviceId").val(),
                    $("#postalCode").val(),
                    $("#email").val(),
                    $("#customerName").val(),
                    $("#spName").val(),
                    $("#status").val(),
                    $("#hasIssue").prop("checked"),
                    $("#fromDate").val(),
                    $("#toDate").val(),
                ]);
                oTable.draw();
            });

            $("#clearBtn").click(function () {
                $("input,#status").val("");
                $("#hasIssue").removeProp("checked");
                $("#searchBtn").trigger("click");
            });

            $("tbody tr").click(function () {
                alert("hello");
            });
        }


        function getDateColumnData(row) {
            return (
                '<img src="../images/calendar2.png" alt="" /><span id = "date">' +
                " " +
                row.serviceDate +
                '</span ><br /><img src="../images/layer-712.png" alt="" />' +
                " " +
                row.serviceTime
            );
        }

        function getCustomerColumnData(row) {
            return (
                '<div class="d-flex align-items-center"><img src="../images/layer-719.png"/><span>' +
                row.customerName +
                " <br/>" +
                row.customerAddress +
                "</span></div>"
            );
        }

        function getSPColumnData(row) {
            if (row.spName == " ") {
                return " ";
            }
            else {
                $(function () {
                    $('.stars').stars((row.spRating).toFixed(2));
                });
                return (
                    '<div class="d-flex align-items-center">' +
                    '<img id="profileImg" src="../images/' +
                    row.spAvtar +
                     '" />' +
                    '<div class="d-flex flex-column users-rating">' +
                    "<span>" +
                    row.spName +
                    "</span>" +
                    '<div class="d-flex align-items-center" data-num-stars="5">' +
                    /*"<span class='stars' data-rating=" + (row.spRating).toFixed(2) + "  data-num-stars='5' ></span>"+*/

                    "<span class='stars' data-num-stars='5' ></span>" +
                    "<span>" +
                    (row.spRating).toFixed(2) +
                    "</span>"
                );
                "</div>"+ "</div>" + "</div>";
            }
        }

        function getStatusColumnData(row) {
            if (row.status == 4) {
                return '<button type="button" class="user-new-button">New</button>';
            }
            else if (row.status == 1) {
                return '<button type="button" class="user-completed-button">Completed</button>';
            }
            else if (row.status == 3) {
                return '<button type="button" class="user-cancelled-button">Cancelled</button>';
            }
            else if (row.status == 2) {
                return '<button type="button" class="user-pending-button">Accepted</button>';
            }
            //else {
            //    return '<button type="button" class="user-new-button">New</button>';
            //}
            /* return '<span class="' + row.status + '">' + row.status + "</span>";*/
        }

        function getActionColumnData(row) {
            var actionString = "";
            if (row.status == 4|| row.status == 2) {
                actionString =
                    '<a class="dropdown-item " data-toggle="modal" data-target="#EditReschedule" onclick="EditModal(' +
                    row.serviceRequestId +
                    ')">Edit & Reschedule</a> <a class="dropdown-item cancelLink" data-toggle="modal" data-target="#CancelModal" onclick="CancelMod(' +
                    row.serviceRequestId +
                    ')" >Cancel SR by Cust</a>';
            } else {
                actionString =
                    '<li><a class="dropdown-item editLink disabled">Edit & Reschedule</a></li> <li><a class="dropdown-item cancelLink disabled">Cancel SR by Cust</a></li>';
            }
            return (
                '<div class="dropdown dropleft">' +
                '<button class="btn " type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">' +
                '<img src="../images/group-38.png"/>' +
                " </button>" +
                '<div class="dropdown-menu" aria-labelledby="dropdownMenuButton">' +
                actionString +
                "</div>" +
                "</div>"
            );
        }

        $.fn.stars = function (rating) {
            return $(this).each(function () {
                /* const rating = $(this).data("rating");*/
                const numStars = $(this).data("numStars");
                const fullStar = '<i class="fas fa-star" style="color : #FFD700"></i>'.repeat(Math.floor(rating));
                const halfStar = (rating % 1 !== 0) ? '<i class="fas fa-star-half-alt" style="color : #FFD700"></i>' : '';
                const noStar = '<i class="fas fa-star" style="color : #e0e0e0"></i>'.repeat(Math.floor(numStars - rating));
                $(this).html(`${fullStar}${halfStar}${noStar}`);
            });
        }
       



        function EditModal(Id) {
            $("#editingmodal").load('@Url.Action("EditModal","Admin")');


            $.post("/Admin/EditServiceRequest", { Id: parseInt(Id) }, function (data) {

                $("#servicedate").val(data.date);

                $("#servicetime").val(data.time);

                $("#address1").val(data.line);
                $("#address2").val(data.linetwo);
                $("#postalcode").val(data.postcode);
                $("#city").val(data.city);
                $("#ia1").val(data.line);
                $("#ia2").val(data.linetwo);
                $("#ipostalcode").val(data.postcode);
                $("#icity").val(data.city);
                $("#upd").prop("value", data.ids);
                // $("#EditReschedule").modal('show');

            });
        }

        function CancelMod(Id) {
            
            $("#cancle").prop("value", Id);



        }


        
    function CancleNow(val) {
        $.post("/Admin/CancleService", { Id: parseInt(val) }, function (data) {

            if (data) {
                // alert("Update Successfully!!");
                $("#CancelModal").modal('hide');
                location.reload();
                //$("#tableDashboard").show();
            }

        });
    }
    

    </script>





</body>
</html>